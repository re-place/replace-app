<div class="py-4">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 md:px-8">
        <h1 class="text-2xl font-semibold text-gray-900">Buchen</h1>
    </div>
    <div class="mx-auto max-w-7xl px-4 sm:px-6 md:px-8">
        <div class="p-5 rounded-lg border-4 border-dashed border-gray-200 xl:flex xl:flex-row">

            <!-- Select Fields -->
            <!-- div class="flex flex-col w-fit"-->
            <div class="flex flex-col xl:w-1/3">

                <form [formGroup]="timeFormControl">
                    <mat-form-field class="w-full">
                        <mat-label>Anfang</mat-label>
                        <input matInput [ngxMatDatetimePicker]="startDateTimePicker"
                               [min]="minDate"
                               placeholder="Choose a date"
                               formControlName="startDate">
                        <mat-datepicker-toggle matSuffix [for]="$any(startDateTimePicker)"></mat-datepicker-toggle>
                        <ngx-mat-datetime-picker #startDateTimePicker>
                        </ngx-mat-datetime-picker>
                    </mat-form-field>
                    <mat-form-field class="w-full">
                        <mat-label>Ende</mat-label>
                        <input matInput [ngxMatDatetimePicker]="endDateTimePicker" placeholder="Choose a date"
                        formControlName="endDate">
                        <mat-datepicker-toggle matSuffix [for]="$any(endDateTimePicker)"></mat-datepicker-toggle>
                        <ngx-mat-datetime-picker #endDateTimePicker>
                        </ngx-mat-datetime-picker>
                    </mat-form-field>
                </form>
                <mat-form-field>
                    <mat-label>Standort</mat-label>
                    <mat-select
                        [(ngModel)]="selectedSite"
                        (selectionChange)="getFloors()">
                        <mat-option *ngIf="sites.length === 0"></mat-option>
                        <mat-option *ngFor="let site of sites" [value]="site">
                            {{ site.name }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field *ngIf="selectedSite">
                    <mat-label>Stockwerk</mat-label>
                    <mat-select
                        [(ngModel)]="selectedFloor"
                        (selectionChange)="getBookableEntities()"
                        [disabled]="floors.length === 1">
                        <mat-option *ngIf="floors.length === 0"></mat-option>
                        <mat-option
                            *ngFor="let floor of floors"
                            [value]="floor">
                            {{ floor.name }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <!--
                    At this point the floor's image should be shown
                    The bookable entities should be marked clearly
                -->

                <!-- This block will be shown at the bottom for mobile -->
                <div class="hidden xl:flex xl:flex-col">
                    <div *ngIf="selectedSite && selectedFloor">
                        <mat-checkbox
                            class="w-1/2"
                            *ngFor="let entity of bookableEntities"
                            (change)="updateSelectedEntities(entity, $event.checked)"
                            [checked]="selectedEntities.includes(entity)"
                            [disabled]="isBooked(entity.id)">
                            {{ entity.name }}
                        </mat-checkbox>
                    </div>


                    <button *ngIf="selectedSite && selectedFloor && selectedEntities.length > 0"
                        mat-raised-button color="primary"
                        (click)="sendBooking()"
                        class="mt-5">
                        Buchung versenden
                    </button>
                </div>


            </div>

            <div class="w-full h-96 xl:h-auto xl:w-2/3">
                <entity-map
                    class="touch-none"
                    *ngIf="selectedSite && selectedFloor"
                    [(entities)]="mapEntities"
                    [backgroundImage]="this.selectedFloor.planFile"
                ></entity-map>
            </div>

            <div class="visible flex flex-col xl:hidden">
                <div *ngIf="selectedSite && selectedFloor">
                    <mat-checkbox
                        class="w-1/2"
                        *ngFor="let entity of bookableEntities"
                        (change)="updateSelectedEntities(entity, $event.checked)"
                        [checked]="selectedEntities.includes(entity)"
                        [disabled]="isBooked(entity.id)">
                        {{ entity.name }}
                    </mat-checkbox>
                </div>

                <button *ngIf="selectedSite && selectedFloor && selectedEntities.length > 0"
                    mat-raised-button color="primary"
                    (click)="sendBooking()"
                    class="mt-5">
                    Buchung versenden
                </button>
            </div>



        </div>
    </div>
</div>
